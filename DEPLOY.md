# GitHubè‡ªåŠ¨éƒ¨ç½²åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨é…ç½®æŒ‡å—

## ğŸ“‹ å‰ç½®æ¡ä»¶

1. âœ… é˜¿é‡Œäº‘æœåŠ¡å™¨å·²å®‰è£…Docker
2. âœ… SSHå¯ä»¥æ­£å¸¸è®¿é—®æœåŠ¡å™¨
3. âœ… ä»£ç å·²æ¨é€åˆ°GitHub

## ğŸ” é…ç½®GitHub Secrets

åœ¨GitHubä»“åº“é¡µé¢ï¼Œè¿›å…¥ `Settings` > `Secrets and variables` > `Actions`ï¼Œç‚¹å‡» `New repository secret` æ·»åŠ ä»¥ä¸‹å¯†é’¥ï¼š

### å¿…éœ€çš„Secretsï¼š

| Secretåç§° | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|-----------|------|--------|
| `ALIYUN_HOST` | é˜¿é‡Œäº‘æœåŠ¡å™¨IPåœ°å€ | `123.456.789.123` |
| `ALIYUN_USER` | æœåŠ¡å™¨ç™»å½•ç”¨æˆ·å | `root` æˆ– `ubuntu` |
| `ALIYUN_SSH_KEY` | SSHç§é’¥å†…å®¹ | ç§é’¥æ–‡ä»¶å®Œæ•´å†…å®¹ |
| `ALIYUN_PORT` | SSHç«¯å£ | `22` (é»˜è®¤) |

### è·å–SSHç§é’¥çš„æ–¹æ³•ï¼š

1. **æ–¹æ³•ä¸€ï¼šä½¿ç”¨ç°æœ‰å¯†é’¥**
   ```bash
   cat ~/.ssh/id_rsa
   ```

2. **æ–¹æ³•äºŒï¼šç”Ÿæˆæ–°å¯†é’¥ï¼ˆæ¨èï¼‰**
   ```bash
   # ç”Ÿæˆæ–°çš„SSHå¯†é’¥å¯¹
   ssh-keygen -t rsa -b 4096 -f ~/.ssh/railway_deploy_key -C "deploy@railway-py"
   
   # æŸ¥çœ‹ç§é’¥ï¼ˆå¤åˆ¶åˆ°GitHub Secretsï¼‰
   cat ~/.ssh/railway_deploy_key
   
   # æŸ¥çœ‹å…¬é’¥ï¼ˆæ·»åŠ åˆ°æœåŠ¡å™¨ï¼‰
   cat ~/.ssh/railway_deploy_key.pub
   ```

3. **å°†å…¬é’¥æ·»åŠ åˆ°æœåŠ¡å™¨**
   ```bash
   # åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
   mkdir -p ~/.ssh
   echo "å…¬é’¥å†…å®¹" >> ~/.ssh/authorized_keys
   chmod 600 ~/.ssh/authorized_keys
   chmod 700 ~/.ssh
   ```

## ğŸš€ è‡ªåŠ¨éƒ¨ç½²æµç¨‹

é…ç½®å®Œæˆåï¼Œæ¯æ¬¡æ¨é€ä»£ç åˆ° `master` åˆ†æ”¯æ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘ä»¥ä¸‹æµç¨‹ï¼š

1. **ä»£ç æ›´æ–°** - åœ¨æœåŠ¡å™¨ä¸Šæ‹‰å–æœ€æ–°ä»£ç 
2. **åœæ­¢æ—§å®¹å™¨** - åœæ­¢å¹¶åˆ é™¤ç°æœ‰çš„Dockerå®¹å™¨
3. **æ„å»ºæ–°é•œåƒ** - ä½¿ç”¨æœ€æ–°ä»£ç æ„å»ºDockeré•œåƒ
4. **å¯åŠ¨æ–°å®¹å™¨** - è¿è¡Œæ–°çš„Dockerå®¹å™¨
5. **å¥åº·æ£€æŸ¥** - æµ‹è¯•æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨
6. **æ¸…ç†èµ„æº** - æ¸…ç†ä¸éœ€è¦çš„Dockeré•œåƒ

## ğŸ”§ æ‰‹åŠ¨éƒ¨ç½²é€‰é¡¹

å¦‚æœéœ€è¦æ‰‹åŠ¨éƒ¨ç½²ï¼Œå¯ä»¥ä½¿ç”¨æä¾›çš„è„šæœ¬ï¼š

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
wget https://raw.githubusercontent.com/maius28/railway-py/master/deploy.sh
chmod +x deploy.sh
./deploy.sh
```

## ğŸ“Š ç›‘æ§å’Œç®¡ç†

### æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
åœ¨GitHub Actionsé¡µé¢æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—ï¼š
`GitHubä»“åº“` > `Actions` > ç‚¹å‡»æœ€æ–°çš„workflowè¿è¡Œ

### æœåŠ¡å™¨ç«¯ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps | grep railway-py

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker logs railway-py -f

# é‡å¯åº”ç”¨
docker restart railway-py

# åœæ­¢åº”ç”¨
docker stop railway-py

# åˆ é™¤åº”ç”¨
docker stop railway-py && docker rm railway-py
```

### æµ‹è¯•æœåŠ¡

```bash
# æœ¬åœ°æµ‹è¯•
curl http://localhost:8000/ping

# è¿œç¨‹æµ‹è¯•
curl http://æœåŠ¡å™¨IP:8000/ping
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **SSHè¿æ¥å¤±è´¥**
   - æ£€æŸ¥æœåŠ¡å™¨IPå’Œç«¯å£
   - ç¡®è®¤SSHå¯†é’¥æ ¼å¼æ­£ç¡®
   - æ£€æŸ¥æœåŠ¡å™¨é˜²ç«å¢™è®¾ç½®

2. **Dockeræ„å»ºå¤±è´¥**
   - æ£€æŸ¥Dockerfileè¯­æ³•
   - ç¡®è®¤requirements.txtæ–‡ä»¶å­˜åœ¨
   - æŸ¥çœ‹æ„å»ºæ—¥å¿—

3. **å®¹å™¨å¯åŠ¨å¤±è´¥**
   - æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
   - æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼š`docker logs railway-py`
   - ç¡®è®¤åº”ç”¨ä»£ç æ— é”™è¯¯

4. **æœåŠ¡æ— æ³•è®¿é—®**
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼š`sudo ufw allow 8000`
   - æ£€æŸ¥é˜¿é‡Œäº‘å®‰å…¨ç»„è§„åˆ™
   - ç¡®è®¤å®¹å™¨ç«¯å£æ˜ å°„æ­£ç¡®

### é˜²ç«å¢™é…ç½®

```bash
# Ubuntu/Debian
sudo ufw allow ssh
sudo ufw allow 8000
sudo ufw enable

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=8000/tcp
sudo firewall-cmd --reload
```

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. GitHub Actionsæ—¥å¿—
2. æœåŠ¡å™¨ä¸Šçš„Dockeræ—¥å¿—
3. ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®

---

é…ç½®å®Œæˆåï¼Œæ¯æ¬¡ `git push` éƒ½ä¼šè‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼ğŸ‰
